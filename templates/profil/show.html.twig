{% extends 'base.html.twig' %}

{% block title %}Profil
	{{ profil.pseudo }}
{% endblock %}

{% block body %}
	{% if app.user.profil.id == app.request.attributes.get('id') and app.user.isVerified == 0 %}
		<div class="user-contain px-5 lg:px-28 py-5 bg-slate-100">
			{% for message in app.flashes('warning') %}
				<div class="">
					<p>{{ message }}</p>
				</div>
			{% endfor %}
			<p>veuillez valider votre compte via l'email de confirmation</p>
			<a href="{{ path("app_resend_confirmation_mail", {id: profil.id}) }}">cliquez ici pour renvoyer le mail de confirmation</a>
		</div>
	{% elseif app.user.profil.id == app.request.attributes.get('id') and app.user.isVerified == 1 and app.user.profil.pseudo == ''  %}
		<div class="user-contain px-5 lg:px-28 py-5 bg-slate-100">

			<p>Félicitation vous êtes bien inscrit, pour accéder aux services, merci de remplir vos informations</p>
			<a href="/profil/{{ app.user.profil.id}}/edit">Je remplis mes informations</a>
		</div>
	{% else %}
		<contain class="user-contain px-5 lg:px-28 py-5 bg-slate-100">
			<div class="header-user flex ">
				<div class="pic_profil">
					<img src="{{ profil.picture }}" alt="" class="user-img">
				</div>
				<infos class="user-infos">
					<h3 class="font-bold ">{{ profil.pseudo }}</h3>
					<h3 class="mb-8">{{ profil.description }}</h3>
					<h3 class="mb-8">{{ profil.city }}</h3>
				</infos>


			</div>
			<hr
			class=" border-black my-5">
			{# <div>
										<div class="bg-white rounded-md shadow-md w-full">
											<h4 class="bg-slate-700 text-white p-2 rounded-t-md">Pages suivies</h4>
										</div>
									</div> #}
			<div class="tab_project flex-responsive w-full justify-between">
				<div class="my-10 w-flex">
					<div class="bg-white rounded-md shadow-md w-full">
						<h4 class="bg-slate-700 text-white p-2 rounded-t-md">Mes salles</h4>

						{% for hallMember in profil.hallMembers %}
							{% if hallMember.status != "reject"%}
								<a href="/hall/{{ hallMember.hall.id }}">

									<div class="flex justify-between p-3 hover:bg-slate-100 items-start">

										<div class="flex relative">

											<div class="img-project-db">
												<img src="{{ hallMember.hall.logo}}" alt="">
											</div>
											{% set counter = 0 %}
												{% set currentDate = date()|date('Y-m-d') %}
												{% for event in hallMember.hall.events %}
													{% if event.status == 3 %}
														{% set counter = counter + 1 %}
													{% endif %}
												{% endfor %}
											{% if counter > 0 %}
												<div class="bg-red-500 text-white px-2 py-1 rounded-full absolute text-xs top-0 left-9">
													{{ counter }}
												</div>
											{% endif %}
											<div class="ml-3">
												<p class="text-blue-400 font-semibold">{{ hallMember.hall.name}}
													({{ hallMember.status|capitalize }})</p>
												{% for hallMemberRole in hallMember.hallMemberRoles %}
													<p>{{ hallMemberRole.roleHall.roleName}}</p>
												{% endfor %}
											</div>
										</div>


										{% if hallMember.status == "guest" %}
											<div>
												<form action="{{ path('app_profil_show', {'id': app.user.profil.id}) }}" method="post">
													<input type="hidden" name="action" value="validate">
													<input type="hidden" name="page" value="hall">
													<input type="hidden" name="hallMemberId" value="{{ hallMember.id }}">
													<button type="submit" class="validate-button px-2 py-1 rounded-lg bg-emerald-300 text-white hover:bg-emerald-500">Valider</button>
												</form>
												<form action="{{ path('app_profil_show', {'id': app.user.profil.id}) }}" method="post">
													<input type="hidden" name="action" value="reject">
													<input type="hidden" name="page" value="hall">
													<input type="hidden" name="hallMemberId" value="{{ hallMember.id }}">
													<button type="submit" class="reject-button px-2 py-1 rounded-lg bg-red-300 text-white hover:bg-red-600">Refuser</button>
												</form>
											</div>
										{% else %}
											{% set countEvent = 0 %}
											{% set countInProgress = 0 %}
											{% set currentDate = date()|date('Y-m-d') %}
											{% for event in hallMember.hall.events %}
												{% if event.date|date('Y-m-d') > currentDate and event.status == 1 %}
													{% set countEvent = countEvent + 1 %}
												{% endif %}
												{% if event.date|date('Y-m-d') > currentDate and event.status == 3 %}
													{% set countInProgress = countInProgress + 1 %}
												{% endif %}
											{% endfor %}
											<div class="flex items-center">
												{{ countEvent }} <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewbox="0 0 24 24" class="mr-3"><path fill="#334155" d="M14.5 18q-1.05 0-1.775-.725T12 15.5q0-1.05.725-1.775T14.5 13q1.05 0 1.775.725T17 15.5q0 1.05-.725 1.775T14.5 18M5 22q-.825 0-1.412-.587T3 20V6q0-.825.588-1.412T5 4h1V2h2v2h8V2h2v2h1q.825 0 1.413.588T21 6v14q0 .825-.587 1.413T19 22zm0-2h14V10H5z"/></svg>
													
											</div>

										{% endif %}

									</div>
								</a>
								<hr>

							{% endif %}

						{% endfor %}
						{% if is_granted('profil_edit', profil) %}
							<div class="p-3">
								<a href="{{ path('app_hall_new') }}" class="text-slate-400 hover:text-blue-500 ">
									<button class="bg-slate-700 rounded-full px-2 pb-1 mr-4 text-white font-bold hover:bg-blue-500">+</button>Créer une nouvelle salle</a>
							</div>
						{% endif %}
					</div>
				</div>
				<div class="my-10 w-flex">
					<div class="bg-white rounded-lg shadow-md  w-full  ">
						<h4 class="bg-slate-700 text-white p-2 rounded-t-md">Mes projets musicaux</h4>


						{% for bandMember in profil.bandMembers %}
							{% if bandMember.status == "member" or bandMember.status == "admin" %}
								<a href="/band/{{ bandMember.band.id }}">
									<div class="flex justify-between p-3 hover:bg-slate-100 items-start">
										<div class="flex relative">
											<div class="img-project-db">
												<img src="{{ bandMember.band.logo}}" alt="">
											</div>
											{% if is_granted('profil_edit', profil) %}
												{% set counter = 0 %}
												{% set currentDate = date()|date('Y-m-d') %}
												{% for bandEvent in bandMember.band.bandEvents %}
													{% if bandEvent.status == "guest" %}
														{% set counter = counter + 1 %}
													{% endif %}
												{% endfor %}
												{% if counter > 0 %}
													<div class="bg-red-500 text-white px-2 py-1 rounded-full absolute text-xs top-0 left-9">
														{{ counter }}
													</div>
												{% endif %}
											{% endif %}

											<div class="ml-3">
												<p class="text-blue-400 font-semibold">{{ bandMember.band.name}}
													({{ bandMember.status|capitalize }})</p>
												{% for BandMemberRole in bandMember.BandMemberRoles %}
													<p>{{ BandMemberRole.roleBand.roleName|capitalize }}</p>
												{% endfor %}
											</div>
										</div>

										{% if bandMember.status == "guest" %}
											<div>
												<form action="{{ path('app_profil_show', {'id': app.user.profil.id}) }}" method="post">
													<input type="hidden" name="action" value="validate">
													<input type="hidden" name="page" value="band">
													<input type="hidden" name="bandMemberId" value="{{ bandMember.id }}">
													<button type="submit" class="validate-button px-2 py-1 rounded-lg bg-emerald-300 text-white hover:bg-emerald-500">Valider</button>
												</form>
												<form action="{{ path('app_profil_show', {'id': app.user.profil.id}) }}" method="post">
													<input type="hidden" name="action" value="reject">
													<input type="hidden" name="page" value="band">
													<input type="hidden" name="bandMemberId" value="{{ bandMember.id }}">
													<button type="submit" class="reject-button px-2 py-1 rounded-lg bg-red-300 text-white hover:bg-red-600">Refuser</button>
												</form>
											</div>
										{% else %}
											{% set countEvent = 0 %}
											{% set countInProgress = 0 %}
											{% set currentDate = date()|date('Y-m-d') %}
											{% for bandEvent in bandMember.band.bandEvents %}
												{% if bandEvent.event.date|date('Y-m-d') > currentDate and bandEvent.status == "validate" %}
													{% set countEvent = countEvent + 1 %}
												{% endif %}
												{% if bandEvent.event.date|date('Y-m-d') > currentDate and bandEvent.status == "guest" %}
													{% set countInProgress = countInProgress + 1 %}
												{% endif %}
											{% endfor %}
											<div class="flex items-center">
												{{ countEvent }} <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewbox="0 0 24 24" class="mr-3"><path fill="#334155" d="M14.5 18q-1.05 0-1.775-.725T12 15.5q0-1.05.725-1.775T14.5 13q1.05 0 1.775.725T17 15.5q0 1.05-.725 1.775T14.5 18M5 22q-.825 0-1.412-.587T3 20V6q0-.825.588-1.412T5 4h1V2h2v2h8V2h2v2h1q.825 0 1.413.588T21 6v14q0 .825-.587 1.413T19 22zm0-2h14V10H5z"/></svg>

											</div>

										{% endif %}

									</div>
								</a>
								<hr>

							{% endif %}
						{% endfor %}
						{% for bandMember in profil.bandMembers %}
							{% if bandMember.status == "guest" and is_granted('profil_edit', profil)%}
								<a href="/band/{{ bandMember.band.id }}">
									<div class="flex justify-between p-3 hover:bg-slate-100 items-center">
										<div class="flex relative">
											<div class="img-project-db">
												<img src="{{ bandMember.band.logo}}" alt="">
											</div>
											{% set counter = 0 %}
											{% for notification in app.user.profil.notifications %}
												{% if notification.status == 1 and notification.receiptId == bandMember.band.id %}
													{% set counter = counter + 1 %}
												{% endif %}
											{% endfor %}
											{% if counter > 0 %}
												<div class="bg-red-500 text-white px-2 py-1 rounded-full absolute text-xs top-0 left-9">
													{{ counter }}
												</div>
											{% endif %}
											<div class="ml-3">
												<p class="text-blue-400 font-semibold">{{ bandMember.band.name}}
													vous invite à les rejoindres</p>
												{% for BandMemberRole in bandMember.BandMemberRoles %}
													<p>{{ BandMemberRole.roleBand.roleName}}</p>
												{% endfor %}
											</div>
										</div>
										<div>
											<form action="{{ path('app_profil_show', {'id': app.user.profil.id}) }}" method="post">
												<input type="hidden" name="action" value="validate">
												<input type="hidden" name="page" value="band">
												<input type="hidden" name="bandMemberId" value="{{ bandMember.id }}">
												<button type="submit" class="validate-button px-2 py-1 rounded-lg bg-emerald-300 text-white hover:bg-emerald-500">Valider</button>
											</form>
											<form action="{{ path('app_profil_show', {'id': app.user.profil.id}) }}" method="post">
												<input type="hidden" name="action" value="reject">
												<input type="hidden" name="page" value="band">
												<input type="hidden" name="bandMemberId" value="{{ bandMember.id }}">
												<button type="submit" class="reject-button px-2 py-1 rounded-lg bg-red-300 text-white hover:bg-red-600">Refuser</button>
											</form>
										</div>
									</div>
								</a>
								<hr>
							{% endif %}
						{% endfor %}
						{% if is_granted('profil_edit', profil) %}
							<div class="p-3">
								<a href="{{ path('app_band_new') }}" class="text-slate-400 hover:text-blue-500 p-3">
									<span class="bg-slate-700 rounded-full px-2 pb-1 mr-4 text-white font-bold hover:bg-blue-500">+</span>Créer un nouveau groupe
								</a>
							</div>
						{% endif %}

					</div>
				</div>
			</div>
		</contain>
	{% endif %}


{% endblock %}
