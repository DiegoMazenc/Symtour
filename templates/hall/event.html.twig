{% extends 'base.html.twig' %}

{% block title %}
	Event
{% endblock %}

{% block body %}
	<div class="user-contain py-5 px-20 bg bg-slate-100">
		<h2>Mes prochains événements</h2>
		{% set groupedEvents = {} %}
		<div class="card-event-list ">
			{% for event in eventCome %}
				{% if event.status == 1  and event.bandStatus == "validate" %}
					{% set eventDate = event.date|format_datetime(locale='fr',pattern="EEEE dd MMMM YYYY") %}
					{% set groupedEvents = groupedEvents|merge({(eventDate): (groupedEvents[eventDate]|default([]))|merge([event.band])}) %}
				{% endif %}
			{% endfor %}
			{% for date, groups  in groupedEvents %}
				<div class="card-event bg-white ">
					<div class="flex bg-slate-700 text-white p-2 rounded-t-md items-center">
						<svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewbox="0 0 24 24" class="mr-3"><path fill="white" d="M14.5 18q-1.05 0-1.775-.725T12 15.5q0-1.05.725-1.775T14.5 13q1.05 0 1.775.725T17 15.5q0 1.05-.725 1.775T14.5 18M5 22q-.825 0-1.412-.587T3 20V6q0-.825.588-1.412T5 4h1V2h2v2h8V2h2v2h1q.825 0 1.413.588T21 6v14q0 .825-.587 1.413T19 22zm0-2h14V10H5z"/></svg>
						<p>{{ date }}</p>
					</div>
					<div class="plateau">
						{% for group in groups %}
							<div class="clic">
								<div class=" flex justify-between items-center">
									<div class="flex p-2 items-center relative">
										<div class="img-project-db border-2 border-green-500 ">
											<img src="{{ group.logo }}" alt="">
										</div>
										<div class=" bg-green-500 text-white px-2 py-1 rounded-full absolute text-xs top-1 left-10">
											✓
										</div>
										<div>
											<p class="text-blue-400 font-semibold">{{ group.name }}</p>
											<p>{{ group.musicCategory.category }}
												/
												{{ group.defineStyle }}</p>
										</div>
									</div>
									<p class="px-5">Détails ▽</p>
								</div>
								<div class="open">
									{% for member in group.bandMembers %}
										<div class="flex justify-between list-member-event">
											<div class="flex">
												<div class="img-profil-event border-2 border-slate-500">
													<img src="{{ member.profil.picture }}" alt="" class="w-5">

												</div>
												<p>{{ member.profil.pseudo }}
												</p>
											</div>
											<p>{{ member.role.roleName }}</p>
										</div>
									{% endfor %}
								</div>
							</div>
							<hr>
						{% endfor %}
							<div class="p-2">
								<a href="#" class="text-slate-400 hover:text-blue-500 " id="toggleSearch">
									<button class="bg-slate-700 rounded-full px-2 pb-1 mr-4 text-white font-bold hover:bg-blue-500">+</button>
									Inviter un groupe
								</a>
								<div class="search-member">
									{{ form_start(searchForm) }}
									{{ form_widget(searchForm.search, {
						'attr': {
							'class': 'w-full border-2 border-blue-200 hover:border-blue-500 rounded-lg p-2 duration-300',
						}
					}) }}
									{{ form_widget(searchForm.submit, {
						'attr': {
							'class': 'hidden',  
						}
					}) }}
									{{ form_end(searchForm) }}
								</div>

								{% for band in band %}
									<div class="clic">
										<div class=" flex justify-between items-center">
											<div class="flex p-2 items-center relative">
												<div class="img-project-db border-2 border-slate-500 ">
													<img src="{{ band.logo }}" alt="">
												</div>

												<div>
													<p class="text-blue-400 font-semibold">{{ band.name }}</p>
													<p>{{ band.musicCategory.category }}
														/
														{{ band.defineStyle }}</p>
												</div>
											</div>

											<form action="{{ path('app_hall_event', {'id': hall.id}) }}" method="post">
												<input type="hidden" name="action" value="guest">
												<input type="hidden" name="bandId" value="{{ band.id }}">
												{# <input type="hidden" name="event_id" value="{{ event.id }}"> #}
												<input type="hidden" name="hall_id" value="{{ hall.id }}">
												<button type="submit" class="validate-button px-2 py-1 rounded-lg bg-emerald-300 text-white hover:bg-emerald-500">Valider</button>
											</form>

										</div>
										<div class="open">
											{% for member in band.bandMembers %}
												<div class="flex justify-between list-member-event">
													<div class="flex">
														<div class="img-profil-event border-2 border-slate-500">
															<img src="{{ member.profil.picture }}" alt="" class="w-5">

														</div>
														<p>{{ member.profil.pseudo }}
														</p>
													</div>
													<p>{{ member.role.roleName }}</p>
												</div>
											{% endfor %}
										</div>
									</div>
									<hr>

								{% endfor %}
							</div>


							{% for event in eventCome %}
								{% if event.bandStatus != "validate" %}
									<p>{{event.band.name}}</p>
								{% endif %}
							{% endfor %}
						</div>
					</div>
				{% endfor %}
			</div>
			<h2>Mes événements passés</h2>
			{% set groupedEventsPast = {} %}
			<div class="card-event-list ">
				{% for event in eventPast %}
					{% if event.status == 1  %}
						{% set eventDate = event.date|format_datetime(locale='fr',pattern="EEEE dd MMMM YYYY") %}
						{% set groupedEventsPast = groupedEventsPast|merge({(eventDate): (groupedEventsPast[eventDate]|default([]))|merge([event.band])}) %}
					{% endif %}
				{% endfor %}
				{% for date, groups in groupedEventsPast %}
					<div class="card-event bg-slate-200 ">
						<div class="flex bg-slate-300 text-white p-2 rounded-t-md items-center">
							<svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewbox="0 0 24 24" class="mr-3"><path fill="white" d="M14.5 18q-1.05 0-1.775-.725T12 15.5q0-1.05.725-1.775T14.5 13q1.05 0 1.775.725T17 15.5q0 1.05-.725 1.775T14.5 18M5 22q-.825 0-1.412-.587T3 20V6q0-.825.588-1.412T5 4h1V2h2v2h8V2h2v2h1q.825 0 1.413.588T21 6v14q0 .825-.587 1.413T19 22zm0-2h14V10H5z"/></svg>
							<p>
								{{ date }}</p>
						</div>
						<div class="plateau">
							<div class="">
								{% for group in groups %}
									<div class="clic">
										<div class=" flex justify-between items-center">
											<div class="flex p-2 items-center">
												<div class="img-project-db border-2 border-slate-500">
													<img src="{{ group.logo }}" alt="">
												</div>
												<div>
													<p class="text-blue-400 font-semibold">{{ group.name }}</p>
													<p>{{ group.musicCategory.category }}
														/
														{{ group.defineStyle }}</p>
												</div>
											</div>
											<p class="px-5">Détails ▽</p>
										</div>
										<div class="open">
											{% for member in group.bandMembers %}
												<div class="flex justify-between list-member-event">
													<div class="flex">
														<div class="img-profil-event border-2 border-slate-500">
															<img src="{{ member.profil.picture }}" alt="" class="w-5">
														</div>
														<p>{{ member.profil.pseudo }}</p>
													</div>
													<p>{{ member.role.roleName }}</p>
												</div>
											{% endfor %}
										</div>
									</div>
									<hr>
								{% endfor %}
							</div>
						</div>
					</div>
				{% endfor %}
			</div>
		</div>


		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
		<script>
			$(document).ready(function () {
$(".clic").click(function () {
$(this).find(".open").toggle();
});
});
		</script>

		<script>

			let toggleSearchLink = document.getElementById('toggleSearch');
toggleSearchLink.addEventListener('click', function () {
let searchMemberDiv = document.querySelector('.search-member');

if (searchMemberDiv.style.display === 'none' || searchMemberDiv.style.display === '') {
searchMemberDiv.style.display = 'block';
toggleSearchLink.style.display = 'none';
} else {
searchMemberDiv.style.display = 'none';
}
});
		</script>
	{% endblock %}
